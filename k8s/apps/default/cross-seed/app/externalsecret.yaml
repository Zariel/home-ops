---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: cross-seed
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: cross-seed-secret
    template:
      engineVersion: v2
      data:
        config.js: |
          module.exports = {
            action: 'inject',
            apiKey: '{{.CROSS_SEED_API_KEY}}',
            blockList: [
              'name:www.Torrenting.com',
              'category:music',
              'tag:not-linked',
            ],
            dataDirs: [
              '/data/media/tv',
              '/data/media/films',
            ],
            maxDataDepth: 4,
            ignoreNonRelevantFilesToResume: true,
            excludeRecentSearch: '6 weeks',
            excludeOlder: '12 weeks',
            searchCadence: '1 week',
            delay: 30,
            duplicateCategories: false,
            flatLinking: false,
            includeEpisodes: true,
            includeNonVideos: false,
            includeSingleEpisodes: true,
            linkCategory: 'cross-seed',
            linkDirs: ['/data/downloads/torrents/complete/cross-seed', '/data/downloads/torrents/complete/music/cross-seed'],
            linkType: 'hardlink',
            matchMode: 'partial',
            outputDir: '/config/torrents',
            port: 80,
            qbittorrentUrl: 'http://qbittorrent.default.svc.cluster.local',
            radarr: ['http://radarr.default.svc.cluster.local/?apikey={{ .RADARR_API_KEY }}'],
            seasonFromEpisodes: 0.8,
            skipRecheck: true,
            sonarr: ['http://sonarr.default.svc.cluster.local/?apikey={{ .SONARR_API_KEY }}'],
            torznab: [
              1, // ath
              2, // lst
              4, // otw
              8, // 
              11, // mtv
              12,
              13,
              14,
              15,
            ].map(i => `http://prowlarr.default.svc.cluster.local/$${i}/api?apikey={{ .PROWLARR_API_KEY }}`),
            useClientTorrents: true,
          };
  dataFrom:
    - extract:
        key: cross-seed
    - extract:
        key: radarr
    - extract:
        key: sonarr
    - extract:
        key: prowlarr
    - extract:
        key: lidarr
