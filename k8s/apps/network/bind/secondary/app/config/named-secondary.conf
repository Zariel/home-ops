# Only define the known VLAN subnets as trusted
acl "trusted" {
  10.0.0.0/8;
};

options {
  directory "/var/cache/bind";
  flush-zones-on-shutdown yes;
  max-ixfr-ratio unlimited;
  serve-stale yes;
  max-stale-ttl 7d;
  stale-answer-ttl 1h;
  allow-query {
    any;
  };
  allow-recursion {
    trusted;
  };
  allow-transfer {
    none;
  };
  allow-update {
    none;
  };
};

logging {
  channel stdout {
    stderr;
    severity info;
    print-category yes;
    print-severity yes;
    print-time yes;
  };
  category security { stdout; };
  category dnssec   { stdout; };
  category default  { stdout; };
};

include "/etc/bind/keys/externaldns.key";

server bind-master.network.svc.cluster.local {
  keys { "externaldns-key"; };
};

zone "cbannister.xyz." {
  type secondary;
  file "/var/cache/bind/db.cbannister.xyz";
  masters { bind-master.network.svc.cluster.local; };
  allow-query { any; };
  allow-notify { key "externaldns-key"; };
};
